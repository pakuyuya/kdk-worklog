# データモデルメモ

最低限のテーブルだけ掲載

----------------------------------------------------------------------------------------------------------

## ユーザー・アクセス権テーブル案

### ログインユーザーマスタ

* ユーザー＝社員ではなく、社員情報を別に切り離しているのがミソ
* 権限をJSONでもたせるのもミソ。は？権限を１レコードずつバラバラにして登録する？死んでしまえ

| # | 列 | 内容 |
|---|----|-----|
| 1 | ユーザーID | 別にログインIDでなくてよい |
| 2 | ユーザー種別 | admin、社員、などを区別するフラグ。ぶっちゃけ冗長性なので、たかが参照値として実装は権限情報に依存したほうがいい。 |
| 3 | ログイン用の情報 | パスワードとか |
| 4 | 権限情報 | 権限をまとめたJSON |
| 5 | お気に入り勤務台帳ID | nullable。任意で１件の社員情報マスタと連携できる。設定していない場合、システムが気分で選ぶ。 |
| 6 | 社員情報ID | nullable。任意で１件の社員情報マスタと連携できる。 |

----------------------------------------------------------------------------------------------------------

### 社員情報マスタ

* 社員情報。
* 印刷とか表示とかに使う用の参考値。
* ログインユーザーに対してレコードがなくてもいいし複数あってもシステムとして稼働する設計にする。（弱い参照のみを許可する）
* 個人情報はencryptしたほうがいいかも。

| # | 列 | 内容 |
|---|----|-----|
| 1 | 社員情報ID | 別にログインIDでなくてよい |
| 2 | 社員番号 | たぶん、えっちゃんがほしいと思う |
| 3 | ほか、個人情報 |  |

----------------------------------------------------------------------------------------------------------

## 勤怠記録のテーブル案

### 勤務台帳マスタ

* 勤務台帳

| # | 列 | 内容 |
|---|----|-----|
| 1 | 勤務台帳ID | 一意キー |
| 2 | 勤務台帳名 | 例：Happy Workahoric実績 |
| 3 | 所有ユーザーID | 必須 |


### 月間勤怠記録テーブル

* 伝票ヘッダみたいなもの
* エクスポートとか扱う単位になると思うので、とりあえず出す。
* 削除フラグはあると面倒くさいので持たせない。

| # | 列 | 内容 |
|---|----|-----|
| 1 | 勤務台帳ID | 必須 |
| 2 | 年月 | YYYYMMの固定長値 |

----------------------------------------------------------------------------------------------------------

### 日時勤怠記録テーブル

* 実記録。明細。
* ちょっと冗長性を持たせて、こいつ単体でも色々な集計ができるようにさせる。
* 削除フラグはあると面倒くさいので持たせない。

| # | 列 | 内容 |
|---|----|-----|
| 1 | 勤務台帳ID | 必須 |
| 2 | 年月 | YYYYMMの固定長値。月間勤怠記録テーブルとくっつけるためのもの。 |
| 3 | 年月日 | Date型。集計クエリを簡素にするため、あえて冗長性をもたせる。 |
| 4 | 実務時間 | 必須。休憩控除を除く実務時間 |
| 5 | 勤務開始日時 | hhmmの固定長。空欄でも可 |
| 6 | 勤務終了日時 | hhmmの固定長。空欄でも可 |
| 7 | 勤務控除時間 | 休憩時間など。0でも可。 |


----------------------------------------------------------------------------------------------------------

## Excelマッピング情報のテーブル案

### Excelテンプレート テーブル

* Excelテンプレートの情報
* Excelファイルのバイナリを実レコードでもつ（blob型とか）

| # | 列 | 内容 |
|---|----|-----|
| 1 | エクセルテンプレートID | エクセルテンプレートの一意キー。 |
| 2 | 所有ユーザーID | 所有するユーザーID。NULLで全体共有。 |
| 3 | テンプレートファイル名 | テンプレートファイル名。UTF-8であること。（SJISダメ絶対） |
| 4 | テンプレート表示名 |  |
| 5 | テンプレート実バイナリ |  |


